<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de TVs Samsung</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}?v=3.3">
</head>

<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>TVs Audax</h1>
                <button class="btn-refresh" onclick="checkAllStatus()" title="Atualizar status">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2" />
                    </svg>
                </button>
            </div>

            <div class="tv-list">
                {% for setor, tvs_do_setor in tvs_por_setor.items() %}
                <div class="sector-group">
                    <h3 class="sector-title">{{ setor }}</h3>
                    {% for tv_nome, tv_info in tvs_do_setor.items() %}
                    <div class="tv-card" id="card-{{ tv_nome }}" onclick="openLogModal('{{ tv_nome }}')">
                        <div class="tv-details">
                            <span class="tv-name">{{ tv_nome }}</span>
                            <span class="tv-setor" data-original-setor="{{ tv_info.setor }}">{{ tv_info.setor }}</span>
                        </div>
                        <div class="tv-actions">
                            <div class="status-icon power-icon" id="power-{{ tv_nome }}" title="Ligar/Desligar"
                                onclick="event.stopPropagation(); openPowerMenu(event, '{{ tv_nome }}')">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M18.36 6.64a9 9 0 1 1-12.73 0"></path>
                                    <line x1="12" y1="2" x2="12" y2="12"></line>
                                </svg>
                            </div>
                            <div class="status-icon menu-icon" id="menu-{{ tv_nome }}" title="Mais Opções"
                                onclick="event.stopPropagation(); openTvMenu(event, '{{ tv_nome }}')">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="1"></circle>
                                    <circle cx="12" cy="5" r="1"></circle>
                                    <circle cx="12" cy="19" r="1"></circle>
                                </svg>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endfor %}
            </div>

            <div class="sidebar-footer">
                <div class="global-control">
                    <span class="global-control-label">Ligar Todas</span>
                    <div class="global-control-actions">
                        <div class="status-icon power-icon global-power-on" id="global-power-on" title="Ligar Todas"
                            onclick="openGlobalLigarMenu(event)">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M18.36 6.64a9 9 0 1 1-12.73 0"></path>
                                <line x1="12" y1="2" x2="12" y2="12"></line>
                            </svg>
                        </div>
                    </div>
                </div>
                <div class="global-control">
                    <span class="global-control-label">Desligar (exceto reuniões)</span>
                    <div class="global-control-actions">
                        <div class="status-icon power-icon global-power-off" id="global-power-off"
                            title="Desligar Todas" onclick="desligarTVsExcetoReunioes()">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M18.36 6.64a9 9 0 1 1-12.73 0"></path>
                                <line x1="12" y1="2" x2="12" y2="12"></line>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <div class="lion-watermark">
            <img src="{{ url_for('static', filename='lion.png') }}" alt="Lion Logo">
        </div>
    </div>

    <!-- Menu de Contexto Individual das TVs -->
    <div id="globalContextMenu" class="tv-context-menu" style="display: none;">
        <button class="menu-option" id="btnReconnectGlobal">
            <svg class="refresh-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M23 4v6h-6"></path>
                <path d="M1 20v-6h6"></path>
                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
            </svg>
            Reconectar
        </button>
        <button class="menu-option" id="btnWallpaperGlobal">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                <polyline points="21 15 16 10 5 21"></polyline>
            </svg>
            Alterar Wallpaper
        </button>
        <button class="menu-option" id="btnListarBisGlobal">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <line x1="8" y1="6" x2="21" y2="6"></line>
                <line x1="8" y1="12" x2="21" y2="12"></line>
                <line x1="8" y1="18" x2="21" y2="18"></line>
                <line x1="3" y1="6" x2="3.01" y2="6"></line>
                <line x1="3" y1="12" x2="3.01" y2="12"></line>
                <line x1="3" y1="18" x2="3.01" y2="18"></line>
            </svg>
            Listar BIs
        </button>
        <button class="menu-option" id="btnEditarBisGlobal">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
            Editar BIs
        </button>
        <button class="menu-option" id="btnAbrirBiGlobal">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                <polyline points="15 3 21 3 21 9"></polyline>
                <line x1="10" y1="14" x2="21" y2="3"></line>
            </svg>
            Abrir BI
        </button>
        <button class="menu-option" id="btnFecharBiGlobal">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="15" y1="9" x2="9" y2="15"></line>
                <line x1="9" y1="9" x2="15" y2="15"></line>
            </svg>
            Fechar BI
        </button>
    </div>

    <!-- Menu de Power Individual -->
    <div id="powerMenu" class="tv-context-menu" style="display: none;">
        <button class="menu-option" id="btnLigarSemBi">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M18.36 6.64a9 9 0 1 1-12.73 0"></path>
                <line x1="12" y1="2" x2="12" y2="12"></line>
            </svg>
            Ligar
        </button>
        <button class="menu-option" id="btnLigarComBi">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M18.36 6.64a9 9 0 1 1-12.73 0"></path>
                <line x1="12" y1="2" x2="12" y2="12"></line>
            </svg>
            Ligar com BI
        </button>
    </div>

    <!-- Menu de Ligar Todas -->
    <div id="globalLigarMenu" class="tv-context-menu" style="display: none;">
        <button class="menu-option" onclick="ligarTodasComBi()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M18.36 6.64a9 9 0 1 1-12.73 0"></path>
                <line x1="12" y1="2" x2="12" y2="12"></line>
            </svg>
            Abrir com BI
        </button>
        <button class="menu-option" onclick="ligarTodasSemBi()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M18.36 6.64a9 9 0 1 1-12.73 0"></path>
                <line x1="12" y1="2" x2="12" y2="12"></line>
            </svg>
            Abrir sem BI
        </button>
    </div>

    <!-- Popup de erro de token -->
    <div id="tokenErrorPopup" class="token-error-popup" style="display: none;">
        <div class="popup-content">
            <span class="popup-icon">⚠️</span>
            <div class="popup-text">
                <strong>Erro na renovação do token</strong>
                <p id="tokenErrorMessage"></p>
                <button class="btn-retry-token" onclick="retryTokenRenewal()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M23 4v6h-6"></path>
                        <path d="M1 20v-6h6"></path>
                        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                    </svg>
                    Tentar Novamente
                </button>
            </div>
            <button class="popup-close" onclick="fecharPopupErro()">×</button>
        </div>
    </div>

    <!-- Modal de Logs -->
    <div id="logModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <button class="modal-close-floating" onclick="fecharLogModal()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            <div class="modal-header">
                <h2 id="logModalTitle">Logs da TV</h2>
            </div>
            <div class="modal-body">
                <div id="logContainer" class="log-container">
                    <div class="log-loading">Carregando logs...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Wallpaper -->
    <div id="wallpaperModal" class="modal-overlay" style="display: none;">
        <div class="modal-content wallpaper-modal">
            <button class="modal-close-floating" onclick="fecharWallpaperModal()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            <div class="modal-header">
                <h2 id="wallpaperModalTitle">Alterar Wallpaper</h2>
            </div>
            <div class="modal-body wallpaper-body">
                <div class="wallpaper-preview" id="wallpaperPreview">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
                        stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                        <polyline points="21 15 16 10 5 21"></polyline>
                    </svg>
                    <p>Selecione uma imagem</p>
                </div>
                <input type="file" id="wallpaperInput" accept="image/*" style="display: none;"
                    onchange="previewWallpaper(event)">
                <div class="wallpaper-actions">
                    <button class="btn-select-image" onclick="document.getElementById('wallpaperInput').click()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="17 8 12 3 7 8"></polyline>
                            <line x1="12" y1="3" x2="12" y2="15"></line>
                        </svg>
                        Selecionar Imagem
                    </button>
                    <button class="btn-send-wallpaper" id="btnSendWallpaper" onclick="enviarWallpaper()" disabled>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="22" y1="2" x2="11" y2="13"></line>
                            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                        </svg>
                        Enviar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de BIs -->
    <div id="bisModal" class="modal-overlay" style="display: none;">
        <div class="modal-content bis-modal">
            <button class="modal-close-floating" onclick="fecharBisModal()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            <div class="modal-header">
                <h2 id="bisModalTitle">BIs da TV</h2>
            </div>
            <div class="modal-body bis-body">
                <div id="bisLoading" class="bis-loading">
                    <svg class="spinning" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2">
                        <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2" />
                    </svg>
                    <span>Carregando...</span>
                </div>
                <div id="bisContent" class="bis-content" style="display: none;">
                    <div class="bis-list" id="bisList"></div>
                    <div class="bis-edit-section" id="bisEditSection" style="display: none;">
                        <div class="bis-urls-container" id="bisUrlsContainer">
                            <!-- URLs serão adicionadas aqui dinamicamente -->
                        </div>
                        <div class="bis-edit-actions">
                            <button class="btn-add-url" onclick="adicionarCampoUrl()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                                Adicionar URL
                            </button>
                            <button class="btn-remove-all" onclick="removerTodasUrls()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="3 6 5 6 21 6"></polyline>
                                    <path
                                        d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                    </path>
                                </svg>
                                Remover Todos
                            </button>
                        </div>
                        <button class="btn-save-bis" id="btnSaveBis" onclick="salvarBis()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                                <polyline points="17 21 17 13 7 13 7 21"></polyline>
                                <polyline points="7 3 7 8 15 8"></polyline>
                            </svg>
                            Salvar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}?v=3.6"></script>
</body>

</html>